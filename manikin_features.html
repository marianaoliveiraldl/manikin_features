
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Manikin Feature Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --yes:#c8e6c9; --no:#ffcdd2; --border:#ddd; --bg:#f6f6f6; --warn:#fff8e1; --warn-border:#ffecb3; }
    body { font-family: Arial, sans-serif; margin: 24px; }
    h2 { margin-top: 0; }
    .controls { display: grid; grid-template-columns: 1fr auto auto auto; gap: 12px; align-items: center; }
    .controls input[type="text"], .controls select, .controls button { padding: 8px; font-size: 14px; }
    .views { display: flex; gap: 8px; }
    .toggle { display: flex; gap: 8px; align-items: center; }
    .subcontrols { display: flex; gap: 8px; align-items: center; }
    table { border-collapse: collapse; width: 100%; margin-top: 16px; }
    th, td { border: 1px solid var(--border); padding: 6px 8px; text-align: left; white-space: nowrap; }
    th { background: var(--bg); position: sticky; top: 0; z-index: 1; }
    .yes { background-color: var(--yes); }
    .no  { background-color: var(--no); }
    .hidden { display: none; }
    .footer { margin-top: 16px; font-size: 12px; color: #666; }
    .warn { background: var(--warn); border: 1px solid var(--warn-border); padding: 10px 12px; margin-bottom: 12px; }
  </style>
</head>
<body>
  <h2>Manikin Feature Map</h2>

  <div id="banner" class="warn hidden">
    âš ï¸ Couldnâ€™t build the data model. Open DevTools (F12) â†’ Console for details.
  </div>

  <div class="controls">
    <input id="searchInput" type="text" placeholder="Search (Feature/Manikin)..." />
    <div class="views">
      <button id="btnComplete">Complete view</button>
      <button id="btnFeature">Feature view</button>
      <button id="btnManikin">Manikin view</button>
    </div>
    <label class="toggle">
      <input type="checkbox" id="hideX" />
      <span>Hide unsupported (X)</span>
    </label>
    <div class="subcontrols">
      <label for="featureSelect">Feature:</label>
      <select id="featureSelect"></select>
      <label for="manikinSelect">Manikin:</label>
      <select id="manikinSelect"></select>
    </div>
  </div>

  <table id="resultsTable"></table>

  <!-- Early global error catcher -->
  <script>
    window.addEventListener('error', function (e) {
      console.log('Global error:', e.message, e.filename, e.lineno, e.colno);
      const banner = document.getElementById('banner');
      banner.classList.remove('hidden');
      banner.textContent = 'âš ï¸ Script error: ' + e.message;
    });
    console.log('ğŸ” mapping.html loaded');
  </script>

  <!-- Embedded CSV -->
  <script>
    const csv = `"Feature","SimMan 3G Plus","SimMan 3G","SimMan 3G Trauma","SimMan 3G Mystic","SimMan Essential","SimMan Essential Bleeding","SimMan ALS","Mama Anne","SimMom","Nursing Anne Simulator","SimBaby","SimJunior","SimNewb"
"Fluids","âœ“ FluidsControl.xaml","X","X","X","X","X","X","X","X","X","X","X","X"
"Circulation","X","X","X","X","âœ“ Circulation_Fluids.xaml","X","âœ“ Circulation_Fluids.xaml","X","âœ“ BleedingView.xaml","âœ“ Circulation_Fluids.xaml","X","X","X"
"Circulation & Bleeding","âœ“ Circulation_Bleeding.xaml","X","X","X","X","X","X","âœ“ BleedingView.xaml","X","X","X","X","X"
"Circulation & Fluids","X","âœ“ Circulation_Fluids.xaml","âœ“ Circulation_Fluids.xaml","âœ“ Circulation_Fluids.xaml","X","âœ“ Circulation_Fluids.xaml","X","X","X","X","X","X","X"
"Circulation & Motions","X","X","X","X","X","X","X","X","X","X","âœ“ Circulation_Fluids.xaml","âœ“ Circulation_Fluids.xaml","âœ“ Circulation_Fluids.xaml"
"Convulsions","âœ“ ConvulsionsControl.xaml","X","X","X","X","X","X","âœ“ ConvulsionsControl.xaml","âœ“ ConvulsionsControl.xaml","X","X","X","X"
"EFM","X","X","X","X","X","X","X","âœ“ CtgInstructorMonitor_View.xaml","âœ“ CtgInstructorMonitor_View.xaml","X","X","X","X"
"EFM Options","X","X","X","X","X","X","X","âœ“ CtgOptionsView.xaml","âœ“ CtgOptionsView.xaml","X","X","X","X"
"Delivery","X","X","X","X","X","X","X","âœ“ Obstetrics_View.xaml","âœ“ Obstetrics_View.xaml","X","X","X","X"
"CPR","âœ“ QCPRLiveView.xaml","âœ“ QCPRLiveView.xaml","âœ“ QCPRLiveView.xaml","âœ“ QCPRLiveView.xaml","âœ“ QCPRLiveView.xaml","âœ“ QCPRLiveView.xaml","âœ“ QCPRLiveView.xaml","âœ“ QCPRLiveView.xaml","X","X","âœ“ QCPRLiveView.xaml","X","X"
"CPR History","âœ“ QCPRHistoryView.xaml","âœ“ QCPRHistoryView.xaml","âœ“ QCPRHistoryView.xaml","âœ“ QCPRHistoryView.xaml","âœ“ QCPRHistoryView.xaml","âœ“ QCPRHistoryView.xaml","âœ“ QCPRHistoryView.xaml","âœ“ QCPRHistoryView.xaml","X","X","âœ“ QCPRHistoryView.xaml","X","X"
"Airway & Breathing","âœ“ AirwayBreathing.xaml","âœ“ AirwayBreathing.xaml","âœ“ AirwayBreathing.xaml","âœ“ AirwayBreathing.xaml","âœ“ AirwayBreathing.xaml","âœ“ AirwayBreathing.xaml","âœ“ AirwayBreathing.xaml","âœ“ AirwayBreathing.xaml","âœ“ AirwayBreathing.xaml","âœ“ AirwayBreathing.xaml","âœ“ AirwayBreathing.xaml","âœ“ AirwayBreathing.xaml","âœ“ AirwayBreathing.xaml"
"Events","âœ“ EventsView_View.xaml","âœ“ EventsView_View.xaml","âœ“ EventsView_View.xaml","âœ“ EventsView_View.xaml","âœ“ EventsView_View.xaml","âœ“ EventsView_View.xaml","âœ“ EventsView_View.xaml","âœ“ EventsView_View.xaml","âœ“ EventsView_View.xaml","âœ“ EventsView_View.xaml","âœ“ EventsView_View.xaml","âœ“ EventsView_View.xaml","âœ“ EventsView_View.xaml"
"Eyes","âœ“ EyeControl.cs","âœ“ EyeControl.cs","âœ“ EyeControl.cs","âœ“ EyeControl.cs","âœ“ EyeControl.cs","âœ“ EyeControl.cs","âœ“ EyeControl.cs","âœ“ EyeControl.cs","âœ“ EyeControl.cs","âœ“ EyeControl.cs","âœ“ EyeControl.cs","âœ“ EyeControl.cs","âœ“ EyeControl.cs"
"Ongoing Care","âœ“ StateView.xaml","âœ“ StateView.xaml","âœ“ StateView.xaml","âœ“ StateView.xaml","âœ“ StateView.xaml","âœ“ StateView.xaml","âœ“ StateView.xaml","âœ“ StateView.xaml","âœ“ StateView.xaml","âœ“ StateView.xaml","âœ“ StateView.xaml","âœ“ StateView.xaml","âœ“ StateView.xaml"
"Patient Monitor","âœ“ PatientMonitorLayout.cpp","âœ“ PatientMonitorLayout.cpp","âœ“ PatientMonitorLayout.cpp","âœ“ PatientMonitorLayout.cpp","âœ“ PatientMonitorLayout.cpp","âœ“ PatientMonitorLayout.cpp","âœ“ PatientMonitorLayout.cpp","âœ“ PatientMonitorLayout.cpp","âœ“ PatientMonitorLayout.cpp","âœ“ PatientMonitorLayout.cpp","âœ“ PatientMonitorLayout.cpp","âœ“ PatientMonitorLayout.cpp","âœ“ PatientMonitorLayout.cpp"
"Session Control","âœ“ SessionControl.xaml","âœ“ SessionControl.xaml","âœ“ SessionControl.xaml","âœ“ SessionControl.xaml","âœ“ SessionControl.xaml","âœ“ SessionControl.xaml","âœ“ SessionControl.xaml","âœ“ SessionControl.xaml","âœ“ SessionControl.xaml","âœ“ SessionControl.xaml","âœ“ SessionControl.xaml","âœ“ SessionControl.xaml","âœ“ SessionControl.xaml"
"Sounds","âœ“ SoundControl.cs","âœ“ SoundControl.cs","âœ“ SoundControl.cs","âœ“ SoundControl.cs","âœ“ SoundControl.cs","âœ“ SoundControl.cs","âœ“ SoundControl.cs","âœ“ SoundControl.cs","âœ“ SoundControl.cs","âœ“ SoundControl.cs","âœ“ SoundControl.cs","âœ“ SoundControl.cs","âœ“ SoundControl.cs"
"Status Bar","âœ“ StatusBar.xaml","âœ“ StatusBar.xaml","âœ“ StatusBar.xaml","âœ“ StatusBar.xaml","âœ“ StatusBar.xaml","âœ“ StatusBar.xaml","âœ“ StatusBar.xaml","âœ“ StatusBar.xaml","âœ“ StatusBar.xaml","âœ“ StatusBar.xaml","âœ“ StatusBar.xaml","âœ“ StatusBar.xaml","âœ“ StatusBar.xaml"
"Theme Control","âœ“ StatesView_View.xaml","âœ“ StatesView_View.xaml","âœ“ StatesView_View.xaml","âœ“ StatesView_View.xaml","âœ“ StatesView_View.xaml","âœ“ StatesView_View.xaml","âœ“ StatesView_View.xaml","âœ“ StatesView_View.xaml","âœ“ StatesView_View.xaml","âœ“ StatesView_View.xaml","âœ“ StatesView_View.xaml","âœ“ StatesView_View.xaml","âœ“ StatesView_View.xaml"
"Session Log","âœ“ LogView.xaml","âœ“ LogView.xaml","âœ“ LogView.xaml","âœ“ LogView.xaml","âœ“ LogView.xaml","âœ“ LogView.xaml","âœ“ LogView.xaml","âœ“ LogView.xaml","âœ“ LogView.xaml","âœ“ LogView.xaml","âœ“ LogView.xaml","âœ“ LogView.xaml","âœ“ LogView.xaml"
"Simulator","âœ“ ManikinStatus.xaml","âœ“ ManikinStatus.xaml","âœ“ ManikinStatus.xaml","âœ“ ManikinStatus.xaml","âœ“ ManikinStatus.xaml","âœ“ ManikinStatus.xaml","âœ“ ManikinStatus.xaml","âœ“ ManikinStatus.xaml","âœ“ ManikinStatus.xaml","âœ“ ManikinStatus.xaml","âœ“ ManikinStatus.xaml","âœ“ ManikinStatus.xaml","âœ“ ManikinStatus.xaml"
"Local PC Status","âœ“ LocalPCStatus.xaml","âœ“ LocalPCStatus.xaml","âœ“ LocalPCStatus.xaml","âœ“ LocalPCStatus.xaml","âœ“ LocalPCStatus.xaml","âœ“ LocalPCStatus.xaml","âœ“ LocalPCStatus.xaml","âœ“ LocalPCStatus.xaml","âœ“ LocalPCStatus.xaml","âœ“ LocalPCStatus.xaml","âœ“ LocalPCStatus.xaml","âœ“ LocalPCStatus.xaml","âœ“ LocalPCStatus.xaml"
"Connections Status","âœ“ ConnectionStatus.xaml","âœ“ ConnectionStatus.xaml","âœ“ ConnectionStatus.xaml","âœ“ ConnectionStatus.xaml","âœ“ ConnectionStatus.xaml","âœ“ ConnectionStatus.xaml","âœ“ ConnectionStatus.xaml","âœ“ ConnectionStatus.xaml","âœ“ ConnectionStatus.xaml","âœ“ ConnectionStatus.xaml","âœ“ ConnectionStatus.xaml","âœ“ ConnectionStatus.xaml","âœ“ ConnectionStatus.xaml"
"Prediction","âœ“ ParameterPredictionWindow.cpp","âœ“ ParameterPredictionWindow.cpp","âœ“ ParameterPredictionWindow.cpp","âœ“ ParameterPredictionWindow.cpp","âœ“ ParameterPredictionWindow.cpp","âœ“ ParameterPredictionWindow.cpp","âœ“ ParameterPredictionWindow.cpp","âœ“ ParameterPredictionWindow.cpp","âœ“ ParameterPredictionWindow.cpp","âœ“ ParameterPredictionWindow.cpp","âœ“ ParameterPredictionWindow.cpp","âœ“ ParameterPredictionWindow.cpp","âœ“ ParameterPredictionWindow.cpp"
"Trends","âœ“ TTrendHandlerControllerGUI.cs","âœ“ TTrendHandlerControllerGUI.cs","âœ“ TTrendHandlerControllerGUI.cs","âœ“ TTrendHandlerControllerGUI.cs","âœ“ TTrendHandlerControllerGUI.cs","âœ“ TTrendHandlerControllerGUI.cs","âœ“ TTrendHandlerControllerGUI.cs","âœ“ TTrendHandlerControllerGUI.cs","âœ“ TTrendHandlerControllerGUI.cs","âœ“ TTrendHandlerControllerGUI.cs","âœ“ TTrendHandlerControllerGUI.cs","âœ“ TTrendHandlerControllerGUI.cs","âœ“ TTrendHandlerControllerGUI.cs"
"Cardiac","âœ“ heartRhythmController.cs","âœ“ heartRhythmController.cs","âœ“ heartRhythmController.cs","âœ“ heartRhythmController.cs","âœ“ heartRhythmController.cs","âœ“ heartRhythmController.cs","âœ“ heartRhythmController.cs","âœ“ heartRhythmController.cs","âœ“ heartRhythmController.cs","âœ“ heartRhythmController.cs","âœ“ heartRhythmController.cs","âœ“ heartRhythmController.cs","âœ“ heartRhythmController.cs"
"Comments","âœ“ CommentControl.cs","âœ“ CommentControl.cs","âœ“ CommentControl.cs","âœ“ CommentControl.cs","âœ“ CommentControl.cs","âœ“ CommentControl.cs","âœ“ CommentControl.cs","âœ“ CommentControl.cs","âœ“ CommentControl.cs","âœ“ CommentControl.cs","âœ“ CommentControl.cs","âœ“ CommentControl.cs","âœ“ CommentControl.cs"
"Learner Patient Monitor Buttons","âœ“ MonitorButtonsController.cs","âœ“ MonitorButtonsController.cs","âœ“ MonitorButtonsController.cs","âœ“ MonitorButtonsController.cs","âœ“ MonitorButtonsController.cs","âœ“ MonitorButtonsController.cs","âœ“ MonitorButtonsController.cs","âœ“ MonitorButtonsController.cs","âœ“ MonitorButtonsController.cs","âœ“ MonitorButtonsController.cs","âœ“ MonitorButtonsController.cs","âœ“ MonitorButtonsController.cs","âœ“ MonitorButtonsController.cs"`;
    console.log('ğŸ“„ CSV string length:', csv.length);
  </script>

  <!-- Main logic -->
  <script>
    function parseCSV(text) {
      const lines = text.split(/\r?\n/).map(l => l.trim()).filter(Boolean);
      const rows = lines.map(line => {
        const cells = []; let i = 0, inQuotes = false, cell = '';
        while (i < line.length) {
          const ch = line[i];
          if (ch === '"') { if (inQuotes && line[i+1] === '"') { cell += '"'; i += 2; } else { inQuotes = !inQuotes; i++; } }
          else if (ch === ',' && !inQuotes) { cells.push(cell); cell = ''; i++; }
          else { cell += ch; i++; }
        }
        cells.push(cell);
        return cells.map(c => c.trim());
      });
      return rows;
    }

    function buildModel(rows) {
      const header = rows[0], manikins = header.slice(1);
      const dataByFeature = {}, dataByManikin = {};
      manikins.forEach(m => dataByManikin[m] = {});
      for (let r = 1; r < rows.length; r++) {
        const feature = rows[r][0]; if (!feature) continue;
        dataByFeature[feature] = {};
        for (let c = 1; c < header.length; c++) {
          const m = header[c], raw = rows[r][c] || '';
          const supported = raw.startsWith('âœ“') ? 'âœ“' : 'X';
          dataByFeature[feature][m] = supported;
          dataByManikin[m][feature] = supported;
        }
      }
      return { features: Object.keys(dataByFeature), manikins, dataByFeature, dataByManikin };
    }

    function renderComplete(el, model, term = '', hideX = false) {
      const t = term.toLowerCase();
      const fRows = model.features.filter(f => !t || f.toLowerCase().includes(t));
      const mCols = model.manikins.filter(m => !t || m.toLowerCase().includes(t));
      let html = '<tr><th>Feature \\ Manikin</th>';
      mCols.forEach(m => html += `<th>${m}</th>`); html += '</tr>';
      fRows.forEach(f => {
        html += `<tr><th>${f}</th>`;
        mCols.forEach(m => {
          const v = model.dataByFeature[f][m]; if (hideX && v !== 'âœ“') html += `<td class="hidden"></td>`;
          else html += `<td class="${v==='âœ“'?'yes':'no'}">${v}</td>`;
        });
        html += `</tr>`;
      });
      el.innerHTML = html;
    }
    function renderFeature(el, f, model, term = '', hideX = false) {
      const t = term.toLowerCase(); el.innerHTML = `<tr><th>Manikin</th><th>${f}</th></tr>`;
      const row = model.dataByFeature[f]; Object.keys(row).forEach(m => {
        const v = row[m]; if (hideX && v !== 'âœ“') return; if (t && !m.toLowerCase().includes(t)) return;
        el.innerHTML += `<tr><td>${m}</td><td class="${v==='âœ“'?'yes':'no'}">${v}</td></tr>`;
      });
    }
    function renderManikin(el, m, model, term = '', hideX = false) {
      const t = term.toLowerCase(); el.innerHTML = `<tr><th>Feature</th><th>${m}</th></tr>`;
      const row = model.dataByManikin[m]; Object.keys(row).forEach(f => {
        const v = row[f]; if (hideX && v !== 'âœ“') return; if (t && !f.toLowerCase().includes(t)) return;
        el.innerHTML += `<tr><td>${f}</td><td class="${v==='âœ“'?'yes':'no'}">${v}</td></tr>`;
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      console.log('ğŸš€ DOMContentLoaded');
      const rows = parseCSV(csv);
      console.log('ğŸ“Š Parsed rows:', rows.length);
      const model = buildModel(rows);
      if (!model || !model.features.length || !model.manikins.length) {
        document.getElementById('banner').classList.remove('hidden');
        console.log('âŒ Model build failed', { rows, model });
        return;
      }
      console.log('âœ… Features:', model.features.length, 'Manikins:', model.manikins.length);

      const featureSelect = document.getElementById('featureSelect');
      const manikinSelect = document.getElementById('manikinSelect');
      const table = document.getElementById('resultsTable');
      const searchInput = document.getElementById('searchInput');
      const hideX = document.getElementById('hideX');
      const btnComplete = document.getElementById('btnComplete');
      const btnFeature = document.getElementById('btnFeature');
      const btnManikin = document.getElementById('btnManikin');

      // Populate selects
      model.features.forEach(f => featureSelect.appendChild(new Option(f, f)));
      model.manikins.forEach(m => manikinSelect.appendChild(new Option(m, m)));
      featureSelect.value = model.features[0];
      manikinSelect.value = model.manikins[0];

      // View state
      let view = 'complete';
      function render() {
        const term = searchInput.value.trim();
        const hx = hideX.checked;
        if (view === 'complete') renderComplete(table, model, term, hx);
        else if (view === 'feature') renderFeature(table, featureSelect.value, model, term, hx);
        else renderManikin(table, manikinSelect.value, model, term, hx);
      }

      // Initial render
      render();

      // Events
      featureSelect.addEventListener('change', render);
      manikinSelect.addEventListener('change', render);
      hideX.addEventListener('change', render);
      searchInput.addEventListener('input', () => render());
      btnComplete.addEventListener('click', () => { view = 'complete'; render(); });
      btnFeature.addEventListener('click',  () => { view = 'feature';  render(); });
      btnManikin.addEventListener('click',  () => { view = 'manikin';  render(); });
    });
  </script>

  <div class="footer">
    Tip: Use <strong>Complete view</strong> to see the full matrix. Search filters rows/columns; enable â€œHide unsupported (X)â€ to focus only on âœ“.
  </div>
</body>
</html>

<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Manikin Feature Map</title>
<style>
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; margin:2rem;}
h1{margin-bottom:0.25rem}
.controls{display:flex; gap:0.75rem; flex-wrap:wrap; align-items:center; margin:0.75rem 0 1rem}
.controls label{display:flex; align-items:center; gap:0.5rem}
.subnav{display:flex; gap:0.5rem}
button.view{padding:0.35rem 0.75rem; border:1px solid #ccc; border-radius:6px; background:#fff; cursor:pointer}
button.view.active{background:#eef4ff; border-color:#91b2ff}
/* Make the table border wrap content, not page */
.table-wrap{overflow:auto; padding:0.25rem; background:transparent; border:none}
.table-frame{display:inline-block; border:1px solid #ddd; border-radius:8px; padding:0.25rem; background:#fff}
/* Fit table to content width */
table{border-collapse:separate; border-spacing:0; width:max-content; display:inline-table}
th, td{border:1px solid #eee; padding:0.6rem 0.9rem; text-align:center; vertical-align:middle; white-space:nowrap}
th{position:sticky; top:0; background:#fafafa; z-index:1}
tr:hover{background:#f9fbff}
/* Status coloring */
.yes{background:#eaf7ea; color:#126012; font-weight:700}
.no{background:#fdeaea; color:#7d0d0d; font-weight:700}
.dev{background:#fff6e5; color:#7a4d00; font-weight:700}
/* Noticeable spacing (gap) without borders */
.gap-col, .gap-cell{min-width:16px; border:none !important; background:transparent}
/* Subtle division for LLEAP/SimPad rows in complete view using spacer row */
.spacer-row td{border:none !important; background:transparent; height:14px; padding:0 !important}
.legend{margin-top:0.5rem; color:#666; font-size:0.9rem}
.badge{display:inline-block; padding:0.15rem 0.5rem; border-radius:999px; font-size:0.8rem}
.badge.yes{background:#d7f1d7; color:#0d4e0d}
.badge.no{background:#f9d7d7; color:#5c0909}
.badge.dev{background:#ffe9c4; color:#5c3a00}
.hidden{display:none !important}
</style>
</head>
<body>
<h1>Manikin Feature Map</h1>

<div class="controls">
  <div class="subnav">
    <button id="btn-complete" class="view active" data-mode="complete">Complete view</button>
    <button id="btn-feature" class="view" data-mode="feature">Feature view</button>
    <button id="btn-manikin" class="view" data-mode="manikin">Manikin view</button>
  </div>
  <label id="feature-wrap" class="hidden">Feature:
    <select id="feature-select"></select>
  </label>
  <label id="manikin-wrap" class="hidden">Manikin:
    <select id="manikin-select"></select>
  </label>
  <label id="hidex-wrap" class="hidden"><input type="checkbox" id="hide-x"/> Hide unsupported (X)</label>
</div>

<div class="table-wrap">
  <div class="table-frame">
    <table id="map"></table>
  </div>
</div>

<p class="legend"><span class="badge yes">✓ Supported</span> <span class="badge no">X Not supported</span> <span class="badge dev">⧗ In development</span></p>
<script>
const dataset = {"features": ["Fluids", "Circulation", "Circulation & Bleeding", "Circulation & Fluids", "Circulation & Motions", "Convulsions", "EFM", "EFM Options", "Delivery", "CPR", "CPR History", "Airway & Breathing", "Cardiac", "Comments", "Connections Status", "Events", "Eyes", "Learner Patient Monitor Buttons", "Local PC Status", "Ongoing Care", "Patient Monitor", "Prediction", "Session Control", "Session Log", "Simulator", "Sounds", "Status Bar", "Theme Control", "Trends", "LLEAP", "SimPad"], "manikins": ["SimMan 3G Plus", "SimMan 3G", "SimMan 3G Trauma", "SimMan 3G Mystic", "SimMan Essential", "SimMan Essential Bleeding", "SimMan ALS", "Mama Anne", "SimMom", "Nursing Anne Simulator", "SimBaby", "SimJunior", "SimNewB", "SimNewB Classic"], "rows": [{"Feature": "Fluids", "SimMan 3G Plus": "✓", "SimMan 3G": "X", "SimMan 3G Trauma": "X", "SimMan 3G Mystic": "X", "SimMan Essential": "X", "SimMan Essential Bleeding": "X", "SimMan ALS": "X", "Mama Anne": "X", "SimMom": "X", "Nursing Anne Simulator": "X", "SimBaby": "X", "SimJunior": "X", "SimNewB": "X", "SimNewB Classic": "In development"}, {"Feature": "Circulation", "SimMan 3G Plus": "X", "SimMan 3G": "X", "SimMan 3G Trauma": "X", "SimMan 3G Mystic": "X", "SimMan Essential": "✓", "SimMan Essential Bleeding": "X", "SimMan ALS": "✓", "Mama Anne": "X", "SimMom": "✓", "Nursing Anne Simulator": "✓", "SimBaby": "X", "SimJunior": "X", "SimNewB": "X", "SimNewB Classic": "In development"}, {"Feature": "Circulation & Bleeding", "SimMan 3G Plus": "✓", "SimMan 3G": "X", "SimMan 3G Trauma": "X", "SimMan 3G Mystic": "X", "SimMan Essential": "X", "SimMan Essential Bleeding": "X", "SimMan ALS": "X", "Mama Anne": "✓", "SimMom": "X", "Nursing Anne Simulator": "X", "SimBaby": "X", "SimJunior": "X", "SimNewB": "X", "SimNewB Classic": "In development"}, {"Feature": "Circulation & Fluids", "SimMan 3G Plus": "X", "SimMan 3G": "✓", "SimMan 3G Trauma": "✓", "SimMan 3G Mystic": "✓", "SimMan Essential": "X", "SimMan Essential Bleeding": "✓", "SimMan ALS": "X", "Mama Anne": "X", "SimMom": "X", "Nursing Anne Simulator": "X", "SimBaby": "X", "SimJunior": "X", "SimNewB": "X", "SimNewB Classic": "In development"}, {"Feature": "Circulation & Motions", "SimMan 3G Plus": "X", "SimMan 3G": "X", "SimMan 3G Trauma": "X", "SimMan 3G Mystic": "X", "SimMan Essential": "X", "SimMan Essential Bleeding": "X", "SimMan ALS": "X", "Mama Anne": "X", "SimMom": "X", "Nursing Anne Simulator": "X", "SimBaby": "✓", "SimJunior": "✓", "SimNewB": "✓", "SimNewB Classic": "✓"}, {"Feature": "Convulsions", "SimMan 3G Plus": "✓", "SimMan 3G": "X", "SimMan 3G Trauma": "X", "SimMan 3G Mystic": "X", "SimMan Essential": "X", "SimMan Essential Bleeding": "X", "SimMan ALS": "X", "Mama Anne": "✓", "SimMom": "✓", "Nursing Anne Simulator": "X", "SimBaby": "X", "SimJunior": "X", "SimNewB": "X", "SimNewB Classic": "In development"}, {"Feature": "EFM", "SimMan 3G Plus": "X", "SimMan 3G": "X", "SimMan 3G Trauma": "X", "SimMan 3G Mystic": "X", "SimMan Essential": "X", "SimMan Essential Bleeding": "X", "SimMan ALS": "X", "Mama Anne": "✓", "SimMom": "✓", "Nursing Anne Simulator": "X", "SimBaby": "X", "SimJunior": "X", "SimNewB": "X", "SimNewB Classic": "In development"}, {"Feature": "EFM Options", "SimMan 3G Plus": "X", "SimMan 3G": "X", "SimMan 3G Trauma": "X", "SimMan 3G Mystic": "X", "SimMan Essential": "X", "SimMan Essential Bleeding": "X", "SimMan ALS": "X", "Mama Anne": "✓", "SimMom": "✓", "Nursing Anne Simulator": "X", "SimBaby": "X", "SimJunior": "X", "SimNewB": "X", "SimNewB Classic": "In development"}, {"Feature": "Delivery", "SimMan 3G Plus": "X", "SimMan 3G": "X", "SimMan 3G Trauma": "X", "SimMan 3G Mystic": "X", "SimMan Essential": "X", "SimMan Essential Bleeding": "X", "SimMan ALS": "X", "Mama Anne": "✓", "SimMom": "✓", "Nursing Anne Simulator": "X", "SimBaby": "X", "SimJunior": "X", "SimNewB": "X", "SimNewB Classic": "In development"}, {"Feature": "CPR", "SimMan 3G Plus": "✓", "SimMan 3G": "✓", "SimMan 3G Trauma": "✓", "SimMan 3G Mystic": "✓", "SimMan Essential": "✓", "SimMan Essential Bleeding": "✓", "SimMan ALS": "✓", "Mama Anne": "✓", "SimMom": "X", "Nursing Anne Simulator": "X", "SimBaby": "✓", "SimJunior": "X", "SimNewB": "X", "SimNewB Classic": "In development"}, {"Feature": "CPR History", "SimMan 3G Plus": "✓", "SimMan 3G": "✓", "SimMan 3G Trauma": "✓", "SimMan 3G Mystic": "✓", "SimMan Essential": "✓", "SimMan Essential Bleeding": "✓", "SimMan ALS": "✓", "Mama Anne": "✓", "SimMom": "X", "Nursing Anne Simulator": "X", "SimBaby": "✓", "SimJunior": "X", "SimNewB": "X", "SimNewB Classic": "In development"}, {"Feature": "Airway & Breathing", "SimMan 3G Plus": "✓", "SimMan 3G": "✓", "SimMan 3G Trauma": "✓", "SimMan 3G Mystic": "✓", "SimMan Essential": "✓", "SimMan Essential Bleeding": "✓", "SimMan ALS": "✓", "Mama Anne": "✓", "SimMom": "✓", "Nursing Anne Simulator": "✓", "SimBaby": "✓", "SimJunior": "✓", "SimNewB": "✓", "SimNewB Classic": "✓"}, {"Feature": "Cardiac", "SimMan 3G Plus": "✓", "SimMan 3G": "✓", "SimMan 3G Trauma": "✓", "SimMan 3G Mystic": "✓", "SimMan Essential": "✓", "SimMan Essential Bleeding": "✓", "SimMan ALS": "✓", "Mama Anne": "✓", "SimMom": "✓", "Nursing Anne Simulator": "✓", "SimBaby": "✓", "SimJunior": "✓", "SimNewB": "✓", "SimNewB Classic": "✓"}, {"Feature": "Comments", "SimMan 3G Plus": "✓", "SimMan 3G": "✓", "SimMan 3G Trauma": "✓", "SimMan 3G Mystic": "✓", "SimMan Essential": "✓", "SimMan Essential Bleeding": "✓", "SimMan ALS": "✓", "Mama Anne": "✓", "SimMom": "✓", "Nursing Anne Simulator": "✓", "SimBaby": "✓", "SimJunior": "✓", "SimNewB": "✓", "SimNewB Classic": "✓"}, {"Feature": "Connections Status", "SimMan 3G Plus": "✓", "SimMan 3G": "✓", "SimMan 3G Trauma": "✓", "SimMan 3G Mystic": "✓", "SimMan Essential": "✓", "SimMan Essential Bleeding": "✓", "SimMan ALS": "✓", "Mama Anne": "✓", "SimMom": "✓", "Nursing Anne Simulator": "✓", "SimBaby": "✓", "SimJunior": "✓", "SimNewB": "✓", "SimNewB Classic": "✓"}, {"Feature": "Events", "SimMan 3G Plus": "✓", "SimMan 3G": "✓", "SimMan 3G Trauma": "✓", "SimMan 3G Mystic": "✓", "SimMan Essential": "✓", "SimMan Essential Bleeding": "✓", "SimMan ALS": "✓", "Mama Anne": "✓", "SimMom": "✓", "Nursing Anne Simulator": "✓", "SimBaby": "✓", "SimJunior": "✓", "SimNewB": "✓", "SimNewB Classic": "✓"}, {"Feature": "Eyes", "SimMan 3G Plus": "✓", "SimMan 3G": "✓", "SimMan 3G Trauma": "✓", "SimMan 3G Mystic": "✓", "SimMan Essential": "✓", "SimMan Essential Bleeding": "✓", "SimMan ALS": "✓", "Mama Anne": "✓", "SimMom": "✓", "Nursing Anne Simulator": "✓", "SimBaby": "✓", "SimJunior": "✓", "SimNewB": "✓", "SimNewB Classic": "✓"}, {"Feature": "Learner Patient Monitor Buttons", "SimMan 3G Plus": "✓", "SimMan 3G": "✓", "SimMan 3G Trauma": "✓", "SimMan 3G Mystic": "✓", "SimMan Essential": "✓", "SimMan Essential Bleeding": "✓", "SimMan ALS": "✓", "Mama Anne": "✓", "SimMom": "✓", "Nursing Anne Simulator": "✓", "SimBaby": "✓", "SimJunior": "✓", "SimNewB": "✓", "SimNewB Classic": "✓"}, {"Feature": "Local PC Status", "SimMan 3G Plus": "✓", "SimMan 3G": "✓", "SimMan 3G Trauma": "✓", "SimMan 3G Mystic": "✓", "SimMan Essential": "✓", "SimMan Essential Bleeding": "✓", "SimMan ALS": "✓", "Mama Anne": "✓", "SimMom": "✓", "Nursing Anne Simulator": "✓", "SimBaby": "✓", "SimJunior": "✓", "SimNewB": "✓", "SimNewB Classic": "✓"}, {"Feature": "Ongoing Care", "SimMan 3G Plus": "✓", "SimMan 3G": "✓", "SimMan 3G Trauma": "✓", "SimMan 3G Mystic": "✓", "SimMan Essential": "✓", "SimMan Essential Bleeding": "✓", "SimMan ALS": "✓", "Mama Anne": "✓", "SimMom": "✓", "Nursing Anne Simulator": "✓", "SimBaby": "✓", "SimJunior": "✓", "SimNewB": "✓", "SimNewB Classic": "✓"}, {"Feature": "Patient Monitor", "SimMan 3G Plus": "✓", "SimMan 3G": "✓", "SimMan 3G Trauma": "✓", "SimMan 3G Mystic": "✓", "SimMan Essential": "✓", "SimMan Essential Bleeding": "✓", "SimMan ALS": "✓", "Mama Anne": "✓", "SimMom": "✓", "Nursing Anne Simulator": "✓", "SimBaby": "✓", "SimJunior": "✓", "SimNewB": "✓", "SimNewB Classic": "✓"}, {"Feature": "Prediction", "SimMan 3G Plus": "✓", "SimMan 3G": "✓", "SimMan 3G Trauma": "✓", "SimMan 3G Mystic": "✓", "SimMan Essential": "✓", "SimMan Essential Bleeding": "✓", "SimMan ALS": "✓", "Mama Anne": "✓", "SimMom": "✓", "Nursing Anne Simulator": "✓", "SimBaby": "✓", "SimJunior": "✓", "SimNewB": "✓", "SimNewB Classic": "✓"}, {"Feature": "Session Control", "SimMan 3G Plus": "✓", "SimMan 3G": "✓", "SimMan 3G Trauma": "✓", "SimMan 3G Mystic": "✓", "SimMan Essential": "✓", "SimMan Essential Bleeding": "✓", "SimMan ALS": "✓", "Mama Anne": "✓", "SimMom": "✓", "Nursing Anne Simulator": "✓", "SimBaby": "✓", "SimJunior": "✓", "SimNewB": "✓", "SimNewB Classic": "✓"}, {"Feature": "Session Log", "SimMan 3G Plus": "✓", "SimMan 3G": "✓", "SimMan 3G Trauma": "✓", "SimMan 3G Mystic": "✓", "SimMan Essential": "✓", "SimMan Essential Bleeding": "✓", "SimMan ALS": "✓", "Mama Anne": "✓", "SimMom": "✓", "Nursing Anne Simulator": "✓", "SimBaby": "✓", "SimJunior": "✓", "SimNewB": "✓", "SimNewB Classic": "✓"}, {"Feature": "Simulator", "SimMan 3G Plus": "✓", "SimMan 3G": "✓", "SimMan 3G Trauma": "✓", "SimMan 3G Mystic": "✓", "SimMan Essential": "✓", "SimMan Essential Bleeding": "✓", "SimMan ALS": "✓", "Mama Anne": "✓", "SimMom": "✓", "Nursing Anne Simulator": "✓", "SimBaby": "✓", "SimJunior": "✓", "SimNewB": "✓", "SimNewB Classic": "✓"}, {"Feature": "Sounds", "SimMan 3G Plus": "✓", "SimMan 3G": "✓", "SimMan 3G Trauma": "✓", "SimMan 3G Mystic": "✓", "SimMan Essential": "✓", "SimMan Essential Bleeding": "✓", "SimMan ALS": "✓", "Mama Anne": "✓", "SimMom": "✓", "Nursing Anne Simulator": "✓", "SimBaby": "✓", "SimJunior": "✓", "SimNewB": "✓", "SimNewB Classic": "✓"}, {"Feature": "Status Bar", "SimMan 3G Plus": "✓", "SimMan 3G": "✓", "SimMan 3G Trauma": "✓", "SimMan 3G Mystic": "✓", "SimMan Essential": "✓", "SimMan Essential Bleeding": "✓", "SimMan ALS": "✓", "Mama Anne": "✓", "SimMom": "✓", "Nursing Anne Simulator": "✓", "SimBaby": "✓", "SimJunior": "✓", "SimNewB": "✓", "SimNewB Classic": "✓"}, {"Feature": "Theme Control", "SimMan 3G Plus": "✓", "SimMan 3G": "✓", "SimMan 3G Trauma": "✓", "SimMan 3G Mystic": "✓", "SimMan Essential": "✓", "SimMan Essential Bleeding": "✓", "SimMan ALS": "✓", "Mama Anne": "✓", "SimMom": "✓", "Nursing Anne Simulator": "✓", "SimBaby": "✓", "SimJunior": "✓", "SimNewB": "✓", "SimNewB Classic": "✓"}, {"Feature": "Trends", "SimMan 3G Plus": "✓", "SimMan 3G": "✓", "SimMan 3G Trauma": "✓", "SimMan 3G Mystic": "✓", "SimMan Essential": "✓", "SimMan Essential Bleeding": "✓", "SimMan ALS": "✓", "Mama Anne": "✓", "SimMom": "✓", "Nursing Anne Simulator": "✓", "SimBaby": "✓", "SimJunior": "✓", "SimNewB": "✓", "SimNewB Classic": "✓"}, {"Feature": "LLEAP", "SimMan 3G Plus": "✓", "SimMan 3G": "✓", "SimMan 3G Trauma": "✓", "SimMan 3G Mystic": "✓", "SimMan Essential": "✓", "SimMan Essential Bleeding": "✓", "SimMan ALS": "✓", "Mama Anne": "✓", "SimMom": "✓", "Nursing Anne Simulator": "✓", "SimBaby": "✓", "SimJunior": "✓", "SimNewB": "✓", "SimNewB Classic": "✓"}, {"Feature": "SimPad", "SimMan 3G Plus": "X", "SimMan 3G": "X", "SimMan 3G Trauma": "X", "SimMan 3G Mystic": "X", "SimMan Essential": "X", "SimMan Essential Bleeding": "X", "SimMan ALS": "✓", "Mama Anne": "X", "SimMom": "✓", "Nursing Anne Simulator": "✓", "SimBaby": "✓", "SimJunior": "X", "SimNewB": "✓", "SimNewB Classic": "✓"}]};
let currentView = 'complete';
let selectedFeature = dataset.features[0] || '';
let selectedManikin = dataset.manikins[0] || '';
let hideUnsupported = false;

const opsFeatures = new Set(dataset.features.filter(f => ['lleap','simpad'].includes(String(f).trim().toLowerCase())));

function normalizeSymbol(val){
  if(!val) return '';
  const v = String(val).trim().toLowerCase();
  if(v === 'in development') return '\u29d7'; // ⧗
  return String(val).trim();
}

function statusClass(val){
  if(!val) return '';
  const v = String(val).trim().toLowerCase();
  if(v === '✓' || v === '\u2713') return 'yes';
  if(v === 'x') return 'no';
  if(v === 'in development' || v === '\u29d7') return 'dev';
  return '';
}

function renderTable(){
  const table = document.getElementById('map');
  const thead = document.createElement('thead');
  const tbody = document.createElement('tbody');
  table.innerHTML = '';

  if(currentView === 'complete'){
    // Header: Feature + all manikins
    const hr = document.createElement('tr');
    ['Feature', ...dataset.manikins].forEach(h=>{ const th=document.createElement('th'); th.textContent=h; hr.appendChild(th); });
    thead.appendChild(hr);

    // Body: full matrix
    let addedSpacer = false;
    dataset.rows.forEach(row=>{
      // Insert a spacer row right before the first ops feature (LLEAP/SimPad)
      if(!addedSpacer && opsFeatures.has(row['Feature'])){
        const spacer = document.createElement('tr'); spacer.className = 'spacer-row';
        const td = document.createElement('td'); td.colSpan = 1 + dataset.manikins.length; spacer.appendChild(td);
        tbody.appendChild(spacer);
        addedSpacer = true;
      }
      const tr = document.createElement('tr');
      const ftd = document.createElement('td'); ftd.textContent = row['Feature']; tr.appendChild(ftd);
      dataset.manikins.forEach(m=>{
        const raw = row[m] || '';
        const td = document.createElement('td');
        td.textContent = normalizeSymbol(raw);
        td.className = statusClass(raw);
        tr.appendChild(td);
      });
      tbody.appendChild(tr);
    });
  }
  else if(currentView === 'feature'){
    // Build list of manikins to show (filter X if hide)
    let manikins = dataset.manikins.slice();
    if(selectedFeature && hideUnsupported){
      const row = dataset.rows.find(r=>r['Feature']===selectedFeature) || {};
      manikins = manikins.filter(m => String(row[m]||'').trim().toUpperCase() !== 'X');
    }
    // Header: manikins only
    const hr = document.createElement('tr');
    manikins.forEach(m=>{ const th=document.createElement('th'); th.textContent=m; hr.appendChild(th); });
    thead.appendChild(hr);

    // Body: one row of statuses for selected feature
    const tr = document.createElement('tr');
    if(selectedFeature){
      const baseRow = dataset.rows.find(r=>r['Feature']===selectedFeature);
      manikins.forEach(m=>{
        const raw = baseRow ? (baseRow[m]||'') : '';
        const td = document.createElement('td');
        td.textContent = normalizeSymbol(raw);
        td.className = statusClass(raw);
        tr.appendChild(td);
      });
    } else {
      const td = document.createElement('td'); td.colSpan = manikins.length || 1; td.textContent = 'Pick a feature'; tr.appendChild(td);
    }
    tbody.appendChild(tr);
  }
  else if(currentView === 'manikin'){
    // Build list of features to show (filter X if hide)
    let feats = dataset.features.slice();
    if(selectedManikin && hideUnsupported){
      feats = feats.filter(f => {
        const row = dataset.rows.find(r=>r['Feature']===f) || {};
        return String(row[selectedManikin]||'').trim().toUpperCase() !== 'X';
      });
    }
    // Header: features + gap column between 'Trends' and first ops feature
    const hr = document.createElement('tr');
    const hasTrends = feats.includes('Trends');
    const hasOps = feats.some(f => opsFeatures.has(f));
    feats.forEach(f=>{ 
      const th=document.createElement('th'); th.textContent=f; hr.appendChild(th); 
      if(hasTrends && f==='Trends' && hasOps){
        const gap = document.createElement('th'); gap.className='gap-col'; hr.appendChild(gap);
      }
    });
    thead.appendChild(hr);

    // Body: one row of statuses for selected manikin with gap cell at same position
    const tr = document.createElement('tr');
    if(selectedManikin){
      feats.forEach(f=>{
        const row = dataset.rows.find(r=>r['Feature']===f);
        const raw = row ? (row[selectedManikin]||'') : '';
        const td = document.createElement('td');
        td.textContent = normalizeSymbol(raw);
        td.className = statusClass(raw);
        tr.appendChild(td);
        if(hasTrends && f==='Trends' && hasOps){
          const gapc = document.createElement('td'); gapc.className='gap-cell'; tr.appendChild(gapc);
        }
      });
    } else {
      const td = document.createElement('td'); td.colSpan = feats.length || 1; td.textContent = 'Pick a manikin'; tr.appendChild(td);
    }
    tbody.appendChild(tr);
  }

  table.appendChild(thead);
  table.appendChild(tbody);
}

function updateControlsVisibility(){
  const featureWrap = document.getElementById('feature-wrap');
  const manikinWrap = document.getElementById('manikin-wrap');
  const hideXWrap = document.getElementById('hidex-wrap');
  featureWrap.classList.toggle('hidden', currentView!=='feature');
  manikinWrap.classList.toggle('hidden', currentView!=='manikin');
  hideXWrap.classList.toggle('hidden', !(currentView==='feature' || currentView==='manikin'));
}

function setView(mode){
  currentView = mode;
  document.querySelectorAll('button.view').forEach(b=>b.classList.toggle('active', b.dataset.mode===currentView));
  updateControlsVisibility();
  renderTable();
}

document.addEventListener('DOMContentLoaded', () => {
  // Populate selects
  const featureSelect = document.getElementById('feature-select');
  const manikinSelect = document.getElementById('manikin-select');
  featureSelect.innerHTML = '<option value="">Select feature...</option><optgroup label="Features"><option value="Fluids">Fluids</option><option value="Circulation">Circulation</option><option value="Circulation &amp; Bleeding">Circulation &amp; Bleeding</option><option value="Circulation &amp; Fluids">Circulation &amp; Fluids</option><option value="Circulation &amp; Motions">Circulation &amp; Motions</option><option value="Convulsions">Convulsions</option><option value="EFM">EFM</option><option value="EFM Options">EFM Options</option><option value="Delivery">Delivery</option><option value="CPR">CPR</option><option value="CPR History">CPR History</option><option value="Airway &amp; Breathing">Airway &amp; Breathing</option><option value="Cardiac">Cardiac</option><option value="Comments">Comments</option><option value="Connections Status">Connections Status</option><option value="Events">Events</option><option value="Eyes">Eyes</option><option value="Learner Patient Monitor Buttons">Learner Patient Monitor Buttons</option><option value="Local PC Status">Local PC Status</option><option value="Ongoing Care">Ongoing Care</option><option value="Patient Monitor">Patient Monitor</option><option value="Prediction">Prediction</option><option value="Session Control">Session Control</option><option value="Session Log">Session Log</option><option value="Simulator">Simulator</option><option value="Sounds">Sounds</option><option value="Status Bar">Status Bar</option><option value="Theme Control">Theme Control</option><option value="Trends">Trends</option></optgroup><optgroup label="Operation form"><option value="LLEAP">LLEAP</option><option value="SimPad">SimPad</option></optgroup>';
  manikinSelect.innerHTML = '<option value="SimMan 3G Plus">SimMan 3G Plus</option><option value="SimMan 3G">SimMan 3G</option><option value="SimMan 3G Trauma">SimMan 3G Trauma</option><option value="SimMan 3G Mystic">SimMan 3G Mystic</option><option value="SimMan Essential">SimMan Essential</option><option value="SimMan Essential Bleeding">SimMan Essential Bleeding</option><option value="SimMan ALS">SimMan ALS</option><option value="Mama Anne">Mama Anne</option><option value="SimMom">SimMom</option><option value="Nursing Anne Simulator">Nursing Anne Simulator</option><option value="SimBaby">SimBaby</option><option value="SimJunior">SimJunior</option><option value="SimNewB">SimNewB</option><option value="SimNewB Classic">SimNewB Classic</option>';

  // Wire selects
  featureSelect.addEventListener('change', e=>{ selectedFeature = e.target.value; renderTable(); });
  manikinSelect.addEventListener('change', e=>{ selectedManikin = e.target.value; renderTable(); });
  document.getElementById('hide-x').addEventListener('change', e=>{ hideUnsupported = e.target.checked; renderTable(); });

  // Wire view buttons
  document.getElementById('btn-complete').addEventListener('click', ()=>setView('complete'));
  document.getElementById('btn-feature').addEventListener('click', ()=>setView('feature'));
  document.getElementById('btn-manikin').addEventListener('click', ()=>setView('manikin'));

  // Init defaults
  selectedFeature = dataset.features[0] || '';
  selectedManikin = dataset.manikins[0] || '';
  updateControlsVisibility();
  renderTable();
});
</script>
</body>
</html>
